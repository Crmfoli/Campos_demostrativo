<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Dashboard RC Engenharia</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f0f2f5; color: #333; margin: 0; }
        .header { background: #fff; padding: 1em 2em; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .header-title { display: flex; align-items: center; gap: 1em; }
        .logo-header { height: 40px; }
        .header h1 { color: #0056b3; margin: 0; font-size: 1.5em; }
        .btn-voltar { font-size: 0.9em; font-weight: bold; color: #007bff; text-decoration: none; background-color: transparent; border: 2px solid #007bff; padding: 0.5em 1em; border-radius: 20px; transition: all 0.3s ease; }
        .btn-voltar:hover { background-color: #007bff; color: white; }
        .main-container { display: flex; justify-content: center; padding: 1.5em; }
        .card { background: #fff; padding: 1.5em; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); width: 100%; max-width: 950px; } /* Aumentei a largura */
        h2 { color: #333; border-bottom: 2px solid #007bff; padding-bottom: 0.5em; margin-top: 0; font-size: 1.2em; }
        table { width: 100%; border-collapse: collapse; margin-top: 1em; }
        th, td { padding: 0.7em; text-align: left; border-bottom: 1px solid #ddd; font-size: 0.9em; }
        th { background-color: #007bff; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-title">
            <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo da Empresa" class="logo-header">
            <h1>Dashboard RC Engenharia</h1>
        </div>
        <div>
            <a href="/mapa" class="btn-voltar">⬅️ Voltar ao Mapa</a>
        </div>
    </div>

    <div class="main-container">
        <div class="card">
            <h2>Últimas Leituras</h2>
            <table id="real-time-table">
                <thead>
                    <tr>
                        <th>Horário</th>
                        <th>Prof. 0,3 m</th>
                        <th>Prof. 0,8 m</th>
                        <th>Prof. 1,5 m</th>
                        <th>Prof. 2,0 m</th>
                        <th>Prof. 2,5 m</th>
                    </tr>
                </thead>
                <tbody id="tabela-dados"></tbody>
            </table>
        </div>
    </div>

    <script>
        let updateInterval;
        const MAX_LINHAS_TABELA = 15;
        
        // ALTERAÇÃO NA FUNÇÃO PARA PREENCHER AS NOVAS COLUNAS
        function renderizarTabela(dados) {
            const tbody = document.getElementById('tabela-dados');
            tbody.innerHTML = '';
            dados.slice(-MAX_LINHAS_TABELA).reverse().forEach(leitura => {
                const newRow = tbody.insertRow();
                newRow.innerHTML = `<td>${leitura.timestamp_completo}</td>
                                    <td>${leitura.p1}</td>
                                    <td>${leitura.p2}</td>
                                    <td>${leitura.p3}</td>
                                    <td>${leitura.p4}</td>
                                    <td>${leitura.p5}</td>`;
            });
        }
        
        // ALTERAÇÃO NA FUNÇÃO PARA ATUALIZAR AS NOVAS COLUNAS
        async function buscarAtualizacao() {
            try {
                const response = await fetch('/api/dados_atuais');
                if (!response.ok) return;
                const novaLeitura = await response.json();
                const tbody = document.getElementById('tabela-dados');
                const newRow = tbody.insertRow(0);
                newRow.innerHTML = `<td>${novaLeitura.timestamp_completo}</td>
                                    <td>${novaLeitura.p1}</td>
                                    <td>${novaLeitura.p2}</td>
                                    <td>${novaLeitura.p3}</td>
                                    <td>${novaLeitura.p4}</td>
                                    <td>${novaLeitura.p5}</td>`;

                while (tbody.rows.length > MAX_LINHAS_TABELA) {
                    tbody.deleteRow(tbody.rows.length - 1);
                }
            } catch (error) {
                console.error("Erro na atualização em tempo real:", error);
            }
        }
        
        async function carregarDados() {
            try {
                const response = await fetch(`/api/dados`);
                if (!response.ok) throw new Error('Falha ao buscar dados');
                const dados = await response.json();
                renderizarTabela(dados);
                if (updateInterval) clearInterval(updateInterval);
                updateInterval = setInterval(buscarAtualizacao, 2000);
            } catch (error) {
                console.error("Erro ao carregar dados:", error);
            }
        }
        document.addEventListener('DOMContentLoaded', carregarDados);
    </script>
</body>
</html>
